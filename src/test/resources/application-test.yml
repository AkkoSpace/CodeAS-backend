# CI性能测试环境配置
server:
  port: 26300

spring:
  # 只排除Redis相关配置，保持其他功能完整
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration

  # 允许Bean定义覆盖和禁用banner
  main:
    allow-bean-definition-overriding: true
    banner-mode: off

  # 数据源配置 - CI环境使用PostgreSQL
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:codeas}
    username: ${DB_USERNAME:test}
    password: ${DB_PASSWORD:test123}
    driver-class-name: org.postgresql.Driver
    hikari:
      minimum-idle: 1
      maximum-pool-size: 3
      auto-commit: true
      idle-timeout: 30000
      connection-timeout: 5000
      connection-test-query: SELECT 1

  # JPA配置 - 不创建表
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false

  # 缓存配置 - 使用本地缓存作为fallback
  cache:
    type: caffeine

  # 禁用Flyway
  flyway:
    enabled: false

# MyBatis Plus配置 - 简化但保持功能
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    call-setters-on-nulls: true
    jdbc-type-for-null: 'null'
  global-config:
    db-config:
      id-type: auto
  mapper-locations: classpath*:mapper/**/*Mapper.xml
  type-aliases-package: space.akko.platform.*.model.entity

# 平台配置 - 最小化
platform:
  security:
    jwt:
      secret: dGVzdC1qd3Qtc2VjcmV0LWZvci1wZXJmb3JtYW5jZS10ZXN0
      expiration: 86400
      refresh-expiration: 604800
      header: Authorization
      prefix: "Bearer "
    password:
      encoder: bcrypt
      strength: 4  # 降低强度提高性能
    login:
      max-attempts: 10  # 宽松限制
      lock-duration: 60   # 1分钟

  # 禁用所有缓存和多级缓存
  cache:
    l1:
      enabled: false
    l2:
      enabled: false
    multi-level:
      enabled: false

  # 禁用审计
  audit:
    enabled: false

  # 简化文件配置
  file:
    upload:
      path: /tmp/uploads
      max-size: 1048576  # 1MB
      allowed-types: txt

  # 禁用配置热重载
  config:
    hot-reload: false

  # 禁用API文档导出
  api-docs:
    export:
      enabled: false

# 管理端点配置 - 只暴露必需的
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: false

# OpenAPI文档配置 - 最小化
springdoc:
  api-docs:
    enabled: true
    path: /api/v3/api-docs
  swagger-ui:
    enabled: false

# 日志配置 - 调试模式
logging:
  level:
    root: INFO
    space.akko: DEBUG
    space.akko.foundation.config.DotenvConfig: DEBUG
    org.springframework: INFO
    org.springframework.boot: DEBUG
    org.springframework.context: DEBUG
    org.hibernate: WARN
    com.baomidou.mybatisplus: WARN
    org.postgresql: WARN
    com.zaxxer.hikari: WARN
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
