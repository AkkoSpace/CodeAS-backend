# 测试环境配置
spring:
  # 排除自动配置，避免连接外部服务
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
      - org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration

  # 允许Bean定义覆盖
  main:
    allow-bean-definition-overriding: true
  # 数据源配置（使用H2内存数据库进行测试）
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
    driver-class-name: org.h2.Driver
    username: sa
    password:

  # H2控制台配置
  h2:
    console:
      enabled: true
      path: /h2-console

  # JPA配置
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.dialect.H2Dialect

  # 禁用Redis（测试环境不需要）
  data:
    redis:
      host: localhost
      port: 6379
      database: 1
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 1
          max-idle: 1
          min-idle: 0

  # 缓存配置
  cache:
    type: simple

  # 禁用Flyway（测试使用JPA自动建表）
  flyway:
    enabled: false

# 日志配置
logging:
  level:
    root: INFO
    space.akko: DEBUG
    org.springframework.boot: DEBUG
    org.springframework.context: DEBUG
    org.springframework.beans: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG

# 平台配置
platform:
  security:
    jwt:
      secret: dGVzdC1qd3Qtc2VjcmV0LWtleS1mb3ItdGVzdGluZw==
      expiration: 3600
      refresh-expiration: 86400

  cache:
    multi-level:
      enabled: false

  file:
    upload:
      path: ./test-uploads
      max-size: 1048576  # 1MB for testing
      allowed-types: jpg,jpeg,png,gif,txt

# 禁用不必要的功能
management:
  endpoints:
    enabled-by-default: false
    web:
      exposure:
        include: health
  endpoint:
    health:
      enabled: true
